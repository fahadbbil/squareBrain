!function(a){"use strict";function b(a){if(a="string"==typeof a?a:a.toString(),-1!==a.indexOf("e"))return-1*parseInt(a.split("e")[1]);var b=1.1.toString().split("1")[1],c=a.split(b);return c.length>1?c[c.length-1].length:0}function c(a,b,c,d){var e,f,g,h,i;return isNaN(b=Math.abs(b))&&(b=2),c=c||",",d=d||".",e=parseInt(a=(+a||0).toFixed(b))+"",f=(f=e.length)>3?f%3:0,i=f?e.substr(0,f)+d:"",g=e.substr(f).replace(/(\d{3})(?=\d)/g,"$1"+d),h=b?c+Math.abs(a-e).toFixed(b).replace(/-/,0).slice(2):"",i+g+h}function d(a,b,d,e,f){e=e||[];var g,h;g=void 0!==e[0]?e[0]:"",h=void 0!==e[1]?e[1]:"",void 0===f&&(f=" "===g||","===g||"."===g?0:2,f=",."===e?2:f),!1!==e&&a.val(c(a.val(),f,h,g));var i=a.val();i.length&&b&&-1===i.indexOf(b)&&a.val("after"===d?i+" "+b:b+" "+i)}function e(a,b,d,e){e=e||[];var f,g,h;return f=void 0!==e[0]?e[0]:"",g=void 0!==e[1]?e[1]:"",h=" "===f||","===f||"."===f?0:2,h=",."===e?2:h,a=c(a,h,g,f),a.length&&b&&-1===a.indexOf(b)&&(a="after"===d?a+" "+b:b+" "+a),a}a.fn.serializeObject=function(){var b={},c=this.serializeArray();return a.each(c,function(){b[this.name]?(b[this.name].push||(b[this.name]=[b[this.name]]),b[this.name].push(this.value||"")):b[this.name]=this.value||""}),b},a(function(){a(".js-emc-price, .js-emc-field").change(function(){var b=a(this);b.data("slider-target")&&a(b.data("slider-target")).val(b.val()).trigger("change")}).on("click",function(){a(this).data("temp-value",a(this).val()),a(this).val(null)}).on("focusout",function(){a(this).val().length||a(this).val(a(this).data("temp-value"))}),a(".js-emc-range-slider").each(function(){var e=a(this);e.rangeslider({polyfill:!1,onSlide:function(f,g){if(e.data("field-target")){var h=a(e.data("field-target"));h.val(g);var i=h.closest(".js-emc-calculator").data("args");if(h.hasClass("js-emc-price")&&d(h,i.currency,i.currency_position,i.number_format),h.hasClass("js-emc-percentage")&&d(h,"%","after",",.",b(e.attr("step"))),e.hasClass("js-emc-down-payment-percentage-calc")){var j=e.closest(".js-emc-calculator"),k=Number(j.find(".js-emc-down-payment-field").val()),l=Number(j.find(".js-emc-purchase-price-field").val());j.find(".js-emc-down-payment-percentage").html(c(k/l*100,1)+"%"),e.hasClass("js-emc-purchase-price-field")&&j.find(".js-emc-down-payment-field").attr("max",l).rangeslider("update",!0)}}}})}).on("change",function(){if(a(this).data("field-target")){var c=a(this),e=a(a(this).data("field-target"));e.val(a(this).val());var f=e.closest(".js-emc-calculator").data("args");e.hasClass("js-emc-price")&&d(e,f.currency,f.currency_position,f.number_format),e.hasClass("js-emc-percentage")&&d(e,"%","after",",.",b(c.attr("step")))}}).trigger("change"),a(".js-emc-submit").click(function(){return a(this).closest("form").submit(),!1}),a(".js-emc-calculator").submit(function(){var b=a(this).serializeObject(),c=a(this).data("args"),d=a.extend({},{purchase_price:0,down_payment:0,home_insurance:0,interest_rate:0,pmi:0,property_tax:0,term_years:0},b);for(var f in d)d[f]=Number(d[f]);var g=d.purchase_price-d.down_payment,h=12*d.term_years,i=d.interest_rate/100/12,j=Math.pow(1+i,h),k=Math.round(i/(j-1)*(-g*j)),l=-k,m=Math.round(d.home_insurance/12*100)/100,n=Math.round(d.property_tax/12*100)/100,o=l+n+m+d.pmi,p=a("#emc-calculator-popup-"+c.uid);return p.length&&a.magnificPopup.open({items:{src:"#emc-calculator-popup-"+c.uid},type:"inline",callbacks:{open:function(){p.find(".js-result-total").html(e(o,c.currency,c.currency_position,c.number_format)),p.find(".js-result-interest").html(e(l,c.currency,c.currency_position,c.number_format));var a=p.find(".js-result-styled").width();p.find(".js-result-styled").css({height:a+"px","line-height":a+"px"}),p.find(".js-result-home-insurance").html(e(m,c.currency,c.currency_position,c.number_format)),p.find(".js-result-property-tax").html(e(n,c.currency,c.currency_position,c.number_format)),p.find(".js-result-pmi").html(e(d.pmi,c.currency,c.currency_position,c.number_format)),new Chartist.Pie(".js-emc-chart",{series:[0,m,n,l,d.pmi]},{donut:!0,showLabel:!1}).on("draw",function(a){if("slice"===a.type){var b=a.element._node.getTotalLength();a.element.attr({"stroke-dasharray":b+"px "+b+"px"});var c={"stroke-dashoffset":{id:"anim"+a.index,dur:100,from:-b+"px",to:"0px",easing:Chartist.Svg.Easing.easeOutQuint,fill:"freeze"}};0!==a.index&&(c["stroke-dashoffset"].begin="anim"+(a.index-1)+".end"),a.element.attr({"stroke-dashoffset":-b+"px"}),a.element.animate(c,!1)}})}}}),!1})})}(jQuery);